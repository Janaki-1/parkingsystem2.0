<!doctype html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="utf-8" />
  <title>Dashboard - SmartParking</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <link rel="stylesheet" href="/css/style.css"/>
</head>
<body>
  <div th:replace="fragments/header :: *"></div>
  <div class="container my-4">
    <div class="row">
      <div class="col-md-8">
        <div class="card mb-3 shadow-sm">
          <div class="card-body">
            <h5 class="card-title">Hello, <span th:text="${user.fullName}">User</span></h5>
            <p class="text-muted">Available slots — pick one and book instantly.</p>

            <div th:if="${available.empty}" class="alert alert-warning">No available slots currently.</div>

            <div class="row g-3">
              <div class="col-md-6" th:each="s : ${available}">
                <div class="card h-100">
                  <div class="card-body">
                    <h6 th:text="${s.label} + ' • ' + s.type"></h6>
                    <p class="mb-1">Price/hr: ₹<span th:text="${s.pricePerHour}">0</span></p>
                    <form th:action="@{/dashboard/book}" method="post">
                      <input type="hidden" name="label" th:value="${s.label}" />
                      <button class="btn btn-primary btn-sm">Book now</button>
                    </form>
                  </div>
                </div>
              </div>
            </div>

          </div>
        </div>

        <div class="card shadow-sm">
          <div class="card-body">
            <h5 class="card-title">My Bookings</h5>
            <div th:if="${bookings.empty}" class="text-muted">You have no bookings.</div>
            <table class="table" th:if="${!bookings.empty}">
              <thead><tr><th>#</th><th>Slot</th><th>Start</th><th>End</th><th>Price</th><th>Action</th></tr></thead>
              <tbody>
                <tr th:each="b, iter : ${bookings}">
                  <td th:text="${iter.index + 1}">1</td>
                  <td th:text="${b.slotLabel}">A1</td>
                  <td th:text="${b.startTime}">time</td>
                  <td th:text="${b.endTime == null ? 'Active' : b.endTime}">-</td>
                  <td th:text="${b.pricePaid == 0 ? (b.endTime==null ? '—' : b.pricePaid) : b.pricePaid}">—</td>
                  <td>
                    <form th:if="${b.endTime==null}" th:action="@{/dashboard/release}" method="post" style="display:inline">
                      <input type="hidden" name="bookingId" th:value="${b.id}" />
                      <button class="btn btn-sm btn-warning">Release</button>
                    </form>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

      </div>

      <div class="col-md-4">
        <div class="card shadow-sm mb-3">
          <div class="card-body">
            <h6>Quick Stats</h6>
            <p>Total available: <strong th:text="${available.size()}">0</strong></p>
            <p>Your username: <strong th:text="${user.username}">user</strong></p>
          </div>
        </div>

        <div class="card shadow-sm">
          <div class="card-body">
            <h6>Tips</h6>
            <ul>
              <li>Minimum charge: quarter hour when you release.</li>
              <li>Admin can add/remove slots from Admin Dashboard.</li>
            </ul>
          </div>
        </div>

      </div>
    </div>
  </div>
</body>
</html>